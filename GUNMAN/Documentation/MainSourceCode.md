# GUNMAN Source Code

このドキュメントでは、GUNMAN のソースコードの主な部分を簡単に説明します。

## GUNMAN GameMode Class

[GUNMAN GameMode](/GUNMAN/Source/GUNMAN/GUNMANGameMode.cpp) はゲーム全体のルールを定義している。  
ここでは、プレイヤーの管理やゲームの状態管理を設定するために使用。

制限時間の UI を表示している。

勝利条件と敗北条件を定義している。  
勝利条件は前は 25 体以上倒さなければならなかったが、敵を強くしたので条件を軽くした。

- 勝利条件：敵を 10 体以上倒す
- 敗北条件：制限時間を過ぎてしまう  
  ※ プレイヤーキャラクターが死んだときは [GUNMAN Character](/GUNMAN/Source/GUNMAN/GUNMANCharacter.cpp) からの処理

## GUNMAN Character Class

[GUNMAN Character](/GUNMAN/Source/GUNMAN/GUNMANCharacter.cpp) はプレイヤーキャラクターの動作を定義している。

### ゲーム開始処理（BeginPlay）

- アニメーション、メッシュ、カメラの設定
- マウスの非表示
- UI の操作をオフ
- FPS やエイムのとき以外はプレイヤーキャラクターが回転しない
- 敵からダメージを受けたときダメージ処理

### ゲーム中常に実行される処理（Tick）

走る処理のタイムライン実行

### 入力処理

すべての入力は Unreal Engine 5 で追加された EnhancedInput を使用している。

- 移動
- ジャンプ
  - ボタン一回押すと一回ジャンプできる
  - 長押しで、永遠にジャンプすることはない
- 走る
  - 走るスピードは一定ではなく、走り始めてから段々と速くなる
  - timeline で実装
- 武器を構える
  - 構えると、照準の UI が表示される
- 攻撃
  - 構えているときにしか攻撃ボタンが効かないようになっている
  - ボタンが押されている間は攻撃し、離すと攻撃をやめる
- FPS/TPS 切り替え
  - フリップフロップで実装
  - ボタンが押されたとき、カメラを変え、一方のメッシュを非表示
- 武器切り替え
  - 装備する順番は決めていない → 修正予定
- 視点変更
  - 360° 回転することができる
- ポーズメニューを開く
  - ポーズ中はゲームは停止され、ポーズメニューの UI のみ動かせる

### その他

このクラスを基底クラスとして、ブループリントの派生クラスを作成している。

そのブループリントでキャラクターのマテリアルを変更した。

- 元々,金色のマテリアルに変えたいと思っていたが、やり方が分からず黄色のような色だったのを金色に修正

|                            修正前                            |                          修正後                          |
| :----------------------------------------------------------: | :------------------------------------------------------: |
| ![GANMANCharacter_Yellow](Images/GANMANCharacter_Yellow.png) | ![GANMANCharacter_Gold](Images/GANMANCharacter_Gold.png) |

## GUNMAN Anim Instance Class

[GUNMAN Anim Instance](/GUNMAN/Source/GUNMAN/GUNMANAnimInstance.cpp) は敵のアニメーションを定義している。

アニメーションが更新されるごとに処理するため、少しでも高速な C++で基底クラスとして構成する。

- 接地の判定
- 方向の設定
- スピードの設定
- 武器を構えているか設定

これらの情報を基に、派生クラスをブループリントで作り、ステートマシンを設定する。
